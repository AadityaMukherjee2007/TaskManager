<!DOCTYPE html>
<html lang="en" {% if request.user.is_authenticated and request.user.profile.dark_mode %}class="dark"{% endif %}>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}{% endblock %}</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            :root {
                --color-primary: 59, 130, 246; /* blue-500 */
                --color-primary-dark: 37, 99, 235; /* blue-600 */
                --color-primary-light: 191, 219, 254; /* blue-100 */
            }
            
            [data-theme="purple"] {
                --color-primary: 168, 85, 247;
                --color-primary-dark: 147, 51, 234;
                --color-primary-light: 243, 232, 255;
            }
            
            [data-theme="green"] {
                --color-primary: 34, 197, 94;
                --color-primary-dark: 22, 163, 74;
                --color-primary-light: 220, 252, 231;
            }
            
            [data-theme="red"] {
                --color-primary: 239, 68, 68;
                --color-primary-dark: 220, 38, 38;
                --color-primary-light: 254, 226, 226;
            }
            
            [data-theme="indigo"] {
                --color-primary: 99, 102, 241;
                --color-primary-dark: 79, 70, 229;
                --color-primary-light: 232, 232, 250;
            }
            
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: #f8fafc;
                transition: background-color 0.3s ease, color 0.3s ease;
            }
            
            html.dark body {
                background-color: #0f172a;
                color: #e2e8f0;
            }
            
            html {
                scroll-behavior: smooth;
            }
            
            /* Dark mode specific styles */
            html.dark nav {
                @apply bg-gray-800 border-b border-gray-700;
            }
            
            html.dark main {
                @apply bg-gray-900;
            }
            
            html.dark footer {
                @apply bg-gray-950 border-t border-gray-800;
            }
            
            html.dark input,
            html.dark textarea,
            html.dark select {
                @apply bg-gray-700 border-gray-600 text-white;
            }
            
            html.dark input:focus,
            html.dark textarea:focus,
            html.dark select:focus {
                @apply bg-gray-600;
            }
            
            /* Card styles */
            .card {
                @apply bg-white rounded-lg shadow-md transition-shadow duration-200;
            }
            
            html.dark .card {
                @apply bg-gray-800 border border-gray-700;
            }
            
            .card:hover {
                @apply shadow-lg;
            }
            
            /* Button styles */
            .btn-primary {
                @apply px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-200;
            }
            
            html.dark .btn-primary {
                @apply bg-blue-600 hover:bg-blue-700;
            }
            
            .btn-secondary {
                @apply px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-900 dark:text-white font-medium rounded-lg transition duration-200;
            }
            
            html.dark .btn-secondary {
                @apply bg-gray-700 hover:bg-gray-600 text-white;
            }
            
            /* Badge styles */
            .badge {
                @apply inline-block px-3 py-1 rounded-full text-xs font-medium;
            }
            
            .badge-success {
                @apply bg-green-100 text-green-800;
            }
            
            html.dark .badge-success {
                @apply bg-green-900 text-green-200;
            }
            
            .badge-warning {
                @apply bg-yellow-100 text-yellow-800;
            }
            
            html.dark .badge-warning {
                @apply bg-yellow-900 text-yellow-200;
            }
            
            .badge-danger {
                @apply bg-red-100 text-red-800;
            }
            
            html.dark .badge-danger {
                @apply bg-red-900 text-red-200;
            }
            
            /* Form styles */
            .form-input {
                @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition;
            }
            
            html.dark .form-input {
                @apply bg-gray-700 border-gray-600 text-white focus:ring-blue-400;
            }
            
            /* Table styles */
            table {
                @apply w-full border-collapse;
            }
            
            th {
                @apply bg-gray-100 dark:bg-gray-700 px-4 py-3 text-left font-semibold text-gray-900 dark:text-gray-100 border-b border-gray-200 dark:border-gray-600;
            }
            
            html.dark th {
                @apply bg-gray-700 text-gray-100 border-gray-600;
            }
            
            td {
                @apply px-4 py-3 border-b border-gray-200;
            }
            
            html.dark td {
                @apply border-gray-600;
            }
            
            /* Smooth transitions */
            * {
                @apply transition-colors duration-200;
            }
        </style>
        <script>
            // Dark mode initialization
            document.addEventListener('DOMContentLoaded', function() {
                const darkMode = localStorage.getItem('darkMode') === 'true' || 
                               (document.documentElement.classList.contains('dark'));
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('darkMode', 'true');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('darkMode', 'false');
                }
            });
        </script>
    </head>
    <body class="bg-gray-50 dark:bg-gray-900">
        <!-- Navigation Bar -->
        <nav class="bg-white dark:bg-gray-800 shadow-md dark:border-b dark:border-gray-700 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Logo/Brand -->
                    <div class="flex items-center space-x-3">
                        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-2 rounded-lg shadow-md">
                            <i class="fas fa-tasks text-white text-xl"></i>
                        </div>
                        <span class="text-2xl font-bold text-gray-800 dark:text-white">TaskManager</span>
                    </div>

                    <!-- Navigation Links -->
                    <div class="hidden md:flex items-center space-x-8">
                        <a href="{% url 'dashboard' %}" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition duration-200 font-medium">
                            <i class="fas fa-home mr-2"></i>Dashboard
                        </a>
                        <a href="{% url 'tasks' %}" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition duration-200 font-medium">
                            <i class="fas fa-tasks mr-2"></i>Tasks
                        </a>
                        <a href="{% url 'settings' %}" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition duration-200 font-medium">
                            <i class="fas fa-cog mr-2"></i>Settings
                        </a>
                    </div>

                    <!-- User Menu -->
                    <div class="flex items-center space-x-4">
                        <!-- Dark Mode Toggle -->
                        <button id="darkModeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            <i class="fas fa-moon text-gray-700 dark:text-yellow-400 text-xl"></i>
                        </button>
                        
                        <button class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            <i class="fas fa-bars text-gray-700 dark:text-gray-300 text-xl"></i>
                        </button>
                        
                        <div class="relative group">
                            <button class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                                {% if request.user.is_authenticated and request.user.profile.avatar %}
                                    <img src="{{ request.user.profile.avatar.url }}" alt="Avatar" class="w-8 h-8 rounded-full">
                                {% else %}
                                    <i class="fas fa-user-circle text-gray-700 dark:text-gray-300 text-2xl"></i>
                                {% endif %}
                                <span class="hidden sm:block text-gray-700 dark:text-gray-300 font-medium">{{ request.user.username }}</span>
                            </button>
                            <div class="absolute right-0 mt-0 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-xl dark:border dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition duration-200">
                                <div class="px-4 py-3 border-b dark:border-gray-700">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Signed in as</p>
                                    <p class="font-semibold text-gray-900 dark:text-white">{{ request.user.email }}</p>
                                </div>
                                <a href="{% url 'profile' %}" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-gray-700 transition border-b dark:border-gray-700">
                                    <i class="fas fa-user mr-2"></i>My Profile
                                </a>
                                <a href="{% url 'settings' %}" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-gray-700 transition border-b dark:border-gray-700">
                                    <i class="fas fa-cog mr-2"></i>Settings
                                </a>
                                <a href="{% url 'logout' %}" class="block px-4 py-3 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-gray-700 transition">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="min-h-screen bg-gray-50 dark:bg-gray-900">
            {% block body %}{% endblock %}
        </main>

        <!-- Footer -->
        <footer class="bg-gray-900 dark:bg-gray-950 text-gray-300 dark:text-gray-400 mt-16 border-t border-gray-700 dark:border-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                    <div>
                        <h3 class="text-white dark:text-gray-100 font-semibold mb-4">About TaskManager</h3>
                        <p class="text-sm">A powerful task management platform designed for teams to collaborate efficiently and stay organized.</p>
                    </div>
                    <div>
                        <h3 class="text-white dark:text-gray-100 font-semibold mb-4">Quick Links</h3>
                        <ul class="text-sm space-y-2">
                            <li><a href="{% url 'dashboard' %}" class="hover:text-blue-400 transition">Dashboard</a></li>
                            <li><a href="{% url 'tasks' %}" class="hover:text-blue-400 transition">Tasks</a></li>
                            <li><a href="{% url 'settings' %}" class="hover:text-blue-400 transition">Settings</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-white dark:text-gray-100 font-semibold mb-4">Support</h3>
                        <ul class="text-sm space-y-2">
                            <li><a href="#" class="hover:text-blue-400 transition">Documentation</a></li>
                            <li><a href="#" class="hover:text-blue-400 transition">Contact Us</a></li>
                            <li><a href="#" class="hover:text-blue-400 transition">Report Issue</a></li>
                        </ul>
                    </div>
                </div>
                <div class="border-t border-gray-700 dark:border-gray-800 pt-8 text-center">
                    <p>&copy; 2026 TaskManager. All rights reserved. | <a href="#" class="hover:text-blue-400 transition">Privacy Policy</a> | <a href="#" class="hover:text-blue-400 transition">Terms of Service</a></p>
                </div>
            </div>
        </footer>

        <!-- Dark Mode Toggle Script -->
        <script>
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', function() {
                    const isDark = document.documentElement.classList.toggle('dark');
                    localStorage.setItem('darkMode', isDark);
                    
                    // Send update to backend
                    fetch('{% url "toggle_dark_mode" %}', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ dark_mode: isDark })
                    });
                });
            }
        </script>
    </body>
</html>
